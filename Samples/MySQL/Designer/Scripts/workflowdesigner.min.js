/*
 * Worflow Engine.NET 1.4.1.1
 * http://workflowenginenet.con
 */
function WorkflowDesigner(e){var t=this;this.Settings=e;this.GetName=function(){return t.Settings.name};this.error=function(e){alert(e)};this.load=function(e){var n=new Array;this.schemecode=e.schemecode;this.processid=e.processid;this.schemeid=e.schemeid;this.readonly=e.readonly;n.push({name:"schemecode",value:this.schemecode});n.push({name:"processid",value:this.processid});n.push({name:"schemeid",value:this.schemeid});n.push({name:"operation",value:"load"});var r=$.ajax({url:this.Settings.apiurl,data:n,async:true,success:function(e){try{t.data=JSON.parse(e)}catch(n){t.error(e)}t.render()},error:function(e,n,r){t.error(n+" "+r)}})};this.exists=function(e){var n=new Array;this.schemecode=e.schemecode;this.processid=e.processid;this.schemeid=e.schemeid;this.readonly=e.readonly;n.push({name:"schemecode",value:this.schemecode});n.push({name:"processid",value:this.processid});n.push({name:"schemeid",value:this.schemeid});n.push({name:"operation",value:"exists"});var r=$.ajax({url:this.Settings.apiurl,data:n,async:false,error:function(e,n,r){t.error(n+" "+r)}}).responseText;try{return JSON.parse(r)}catch(i){t.error(r);return false}};this.create=function(){var e=new Array;e.push({name:"operation",value:"load"});var n=$.ajax({url:this.Settings.apiurl,data:e,async:true,success:function(e){try{t.data=JSON.parse(e)}catch(n){t.error(e)}t.render()}})};this.render=function(){if(t.Graph)t.Graph.destroy();t.Graph=new WorkflowGraph(this.Settings.renderTo,t.Settings,[WorkflowDesignerBackground,WorkflowDesignerToolbar,WorkflowDesignerActivity,WorkflowDesignerTransition,WorkflowDesignerKeyboard]);WorkflowDesignerCommon.DataCorrection(t.data);t.Graph.Draw(t.data)};this.save=function(e){if(t.readonly){alert(WorkflowDesignerConstants.ErrorReadOnlySaveText);return}var n=new Array;n.push({name:"schemecode",value:this.schemecode});n.push({name:"processid",value:this.processid});n.push({name:"schemeid",value:this.schemeid});n.push({name:"operation",value:"save"});n.push({name:"data",value:JSON.stringify(this.data)});var r=$.ajax({url:this.Settings.apiurl,data:n,async:true,type:"post",success:function(n){try{t.data=JSON.parse(n)}catch(r){t.error(n)}t.render();if(e){setTimeout(function(){e(t)},100)}}})};this.downloadscheme=function(e){var t=new Array;t.push({name:"operation",value:"downloadscheme"});t.push({name:"data",value:JSON.stringify(this.data)});WorkflowDesignerCommon.download(this.Settings.apiurl,t,"post")};this.uploadscheme=function(e,n){var r=this.GetName()+"_uploadiframe";var i=document.createElement("iframe");i.setAttribute("id",r);i.setAttribute("name",r);i.setAttribute("width","0");i.setAttribute("height","0");i.setAttribute("border","0");i.setAttribute("style","width: 0; height: 0; border: none;");e.parentNode.appendChild(i);window.frames[r].name=r;iframeId=document.getElementById(r);var s=function(){if(iframeId.detachEvent)iframeId.detachEvent("onload",s);else iframeId.removeEventListener("load",s,false);if(iframeId.contentDocument){content=iframeId.contentDocument.body.innerHTML}else if(iframeId.contentWindow){content=iframeId.contentWindow.document.body.innerHTML}else if(iframeId.document){content=iframeId.document.body.innerHTML}t.data=JSON.parse(content);t.render();setTimeout("iframeId.parentNode.removeChild(iframeId)",250);if(n)n(t)};if(iframeId.addEventListener)iframeId.addEventListener("load",s,true);if(iframeId.attachEvent)iframeId.attachEvent("onload",s);e.setAttribute("target",r);e.setAttribute("action",this.createurl("uploadscheme"));e.setAttribute("method","post");e.setAttribute("enctype","multipart/form-data");e.setAttribute("encoding","multipart/form-data");e.submit()};this.createurl=function(e){var t=this.Settings.apiurl;var n="?";if(t.indexOf("?")>=0)n="&";t+=n+"operation="+e;n="&";if(this.schemeid!=undefined){t+=n+"schemeid="+this.schemeid}if(this.processid!=undefined){t+=n+"processid="+this.processid}if(this.schemecode!=undefined){t+=n+"schemecode="+this.schemecode}return t};this.validate=function(){var e=undefined;var n=$.grep(t.data.Activities,function(e){return e.IsInitial==true});if(n.length!=1)e=WorkflowDesignerConstants.ErrorActivityIsInitialCountText;return e};this.destroy=function(){this.schemecode=undefined;this.processid=undefined;this.schemeid=undefined;this.data=undefined;this.Graph.destroy()}}function WorkflowDesignerActivity(){this.type="WorkflowDesignerActivity";this.init=function(e){this.designer=e;this.Layer=new Kinetic.Layer;this.designer.Stage.add(this.Layer);this.Layer.setZIndex(1);this.ImageCreateTransitionAndActivity=new Image;this.ImageCreateTransitionAndActivity.src=this.designer.Settings.imagefolder+"designer.createat.png";this.ImageCreateTransition=new Image;this.ImageCreateTransition.src=this.designer.Settings.imagefolder+"designer.createt.png";this.ImageDeleteActivity=new Image;this.ImageDeleteActivity.src=this.designer.Settings.imagefolder+"designer.delete.png"};this.ItemControls=new Array;this.draw=function(){if(this.ItemControls!=null){this.ItemControls.forEach(function(e){e.control.destroy()})}this.ItemControls=new Array;var e=this;if(this.designer.data.Activities!=undefined){this.designer.data.Activities.forEach(function(t){var n,r;if(t.DesignerSettings.X!=""&&t.DesignerSettings.Y!=""){n=Number(t.DesignerSettings.X);r=Number(t.DesignerSettings.Y)}else{var i=this.GetDefaultPosition();n=i.x;r=i.y}var s=new WorkflowDesignerActivityControl({x:n,y:r,item:t,designer:e.designer,manager:e});e.ItemControls.push(s);s.Draw();s.Sync()})}this.Layer.batchDraw()};this.CreateNewActivity=function(e,t){if(e==undefined){e=this.GetDefaultPosition()}if(t==undefined)t={IsAutoSchemeUpdate:true,IsForSetState:true};if(t.Name==undefined)t.Name=this.GetDefaultName();if(this.designer.data.Activities.length==0)t.IsInitial=true;if(t.DesignerSettings){t.DesignerSettings=new{X:e.x,Y:e.y}}var n=new WorkflowDesignerActivityControl({x:e.x,y:e.y,item:t,designer:this.designer,manager:this});this.designer.data.Activities.push(t);this.ItemControls.push(n);n.Draw();n.Sync();return n};this.GetDefaultName=function(){var e=WorkflowDesignerConstants.ActivityNamePrefix;var t=1;for(var n=0;n<this.designer.data.Activities.length;n++){var r=this.designer.data.Activities[n];if(r.Name==e+t){t++;n=-1}}return e+t};this.GetDefaultPosition=function(){var e=this.designer.CorrectPossition({x:50,y:50},this.Layer);var t=this.designer.Settings.DefaultMoveStep/this.Layer.getScaleX();for(var n=0;n<this.ItemControls.length;n++){var r=this.ItemControls[n].control.getPosition();if(r.x==e.x&&r.y==e.y){e.x+=t;e.y+=t;n=-1}}return e};this.find=function(e){if(typeof e=="object"&&e.Name!=undefined)return this.find(e.Name);for(var t=0;t<this.ItemControls.length;t++){if(this.ItemControls[t].GetName()==e)return this.ItemControls[t]}return undefined};this.getIntersectingActivity=function(e){for(var t=0;t<this.ItemControls.length;t++){var n=this.ItemControls[t];if(n.getIntersectingActivity(e))return n}return undefined};this.LayerSetOffset=function(e){this.Layer.setOffset(e)};this.LayerScale=function(e){this.Layer.setScale({x:this.Layer.getScale().x+e,y:this.Layer.getScale().y+e})};this.LayerScaleNorm=function(e){this.Layer.setScale({x:1,y:1});this.Layer.setOffset({x:0,y:0})};this.redrawTransitions=function(){if(this.cTransition==undefined){this.cTransition=this.designer.GetComponentByType("WorkflowDesignerTransition")}return this.cTransition.batchDraw()};this.batchDraw=function(){this.Layer.batchDraw()};this.DeselectAll=function(){this.ItemControls.forEach(function(e){e.Deselect()})};this.GetSizeForSaveAsImage=function(e){for(var t=0;t<this.ItemControls.length;t++){var n=this.ItemControls[t];var r=n.rectangle.getAbsolutePosition();var i=r.x;var s=r.y;var o=i+n.rectangle.getWidth()*this.Layer.getScaleX();var u=s+n.rectangle.getHeight()*this.Layer.getScaleX();if(i<e.x1)e.x1=i;if(s<e.y1)e.y1=s;if(o>e.x2)e.x2=o;if(u>e.y2)e.y2=u}return e};this.GetSelected=function(){var e=new Array;this.ItemControls.forEach(function(t){if(t.selected)e.push(t)});return e};this.SelectByPosition=function(e){this.ItemControls.forEach(function(t){if(t.getIntersectingActivityRect(e))t.Select()})};this.SelectByItem=function(e){this.ItemControls.forEach(function(t){if(t.item==e)t.Select()})};this.ObjectMove=function(e){this.ItemControls.forEach(function(t){if(t.selected&&e.sender!=t){t.ObjectMove(e.changepos)}});this.redrawTransitions()};this.createTransitionAndActivity=function(e){var t={x:e.control.getX()+e.rectangle.attrs.width*2,y:e.control.getY()};var n=this.CreateNewActivity(t);var r=this.designer.GetComponentByType("WorkflowDesignerTransition");r.CreateNewTransition(e,n);this.designer.redrawAll()};this.createTransition=function(e){var t=this.designer.GetComponentByType("WorkflowDesignerTransition");return t.CreateNewTransition(e)}}function WorkflowDesignerActivityControl(e){var t=this;this.manager=e.manager;this.designer=e.designer;this.x=e.x;this.y=e.y;this.item=e.item;this.control=undefined;this.rectangle=undefined;this.text=undefined;this.deleteButton=undefined;this.createTransitionAndActivityButton=undefined;this.createTransitionButton=undefined;this.selected=false;this.dependentTransitions=new Array;this.getX=function(){return this.rectangle.attrs.x+this.control.attrs.x};this.getY=function(){return this.rectangle.attrs.y+this.control.attrs.y};this.GetName=function(){return this.item.Name};this.SetName=function(e){this.item.Name=e};this.Draw=function(){var n=t.designer.Settings;t.control=new Kinetic.Group({x:e.x,y:e.y,rotationDeg:0,draggable:true,dragBoundFunc:function(e){var r=n.DefaultMoveStep*t.manager.Layer.getScaleX();var i=n.DefaultMoveStep*t.manager.Layer.getScaleY();var e={x:Math.round(e.x/i)*i,y:Math.round(e.y/i)*i};if(t.selected){var s=this.getAbsolutePosition();t.manager.ObjectMove({sender:t,changepos:{x:e.x-s.x,y:e.y-s.y}})}return e}});var r=WorkflowDesignerConstants.ActivityColor;if(t.item.IsFinal)r=WorkflowDesignerConstants.ActivityFinalColor;if(t.item.IsInitial)r=WorkflowDesignerConstants.ActivityInitialColor;if(t.designer.GetCurrentActivity()==t.item.Name)r=WorkflowDesignerConstants.ActivityCurrentColor;t.rectangle=new Kinetic.Rect({x:0,y:0,width:this.designer.Settings.DefaultActivityWidth,height:this.designer.Settings.DefaultActivityHeight,stroke:"black",strokeWidth:1,fill:r,shadowOpacity:.5});t.text=new Kinetic.Text({x:2,y:2,text:this.GetName(),fontSize:12,fontFamily:"Calibri",fontStyle:"bold",fill:"black"});t.text.setX((t.rectangle.attrs.width-t.text.getWidth())/2);t.text.setY((t.rectangle.attrs.height-t.text.getHeight())/2-6);if(t.item.State==undefined)t.item.State="";t.stateText=new Kinetic.Text({x:2,y:2,text:WorkflowDesignerConstants.ActivityFormLabel.State+": "+t.item.State,fontSize:10,fontFamily:"Calibri",fill:"black"});t.stateText.setX((t.rectangle.attrs.width-t.stateText.getWidth())/2);t.stateText.setY(t.text.getY()+15);t.deleteButton=new Kinetic.Image({x:t.rectangle.attrs.width-13,y:3,image:t.manager.ImageDeleteActivity,width:10,height:10});t.createTransitionAndActivityButton=new Kinetic.Image({x:t.rectangle.attrs.width-13,y:t.rectangle.attrs.height-26,image:t.manager.ImageCreateTransitionAndActivity,width:10,height:10});t.createTransitionButton=new Kinetic.Image({x:t.rectangle.attrs.width-13,y:t.rectangle.attrs.height-13,image:t.manager.ImageCreateTransition,width:10,height:10});t.control.add(t.rectangle);t.control.add(t.text);t.control.add(t.stateText);t.control.add(t.deleteButton);t.control.add(t.createTransitionAndActivityButton);t.control.add(t.createTransitionButton);this.control.on("dragend",this.Sync);this.control.on("dragmove",this._onMove);this.control.on("click",this._onClick);this.control.on("dblclick",this._onDblClick);this.deleteButton.on("click",this._onDelete);this.createTransitionAndActivityButton.on("click",this._onCreateTransitionAndActivity);this.createTransitionButton.on("click",this._onCreateTransition);t.manager.Layer.add(t.control)};this.Delete=function(){this.control.destroy();this.designer.data.Activities.splice(this.designer.data.Activities.indexOf(this.item),1);this.manager.ItemControls.splice(this.manager.ItemControls.indexOf(this),1);var e=new Array;for(var t=0;t<this.dependentTransitions.length;t++){e.push(this.dependentTransitions[t])}for(var t=0;t<e.length;t++){e[t].Delete()}};this.Select=function(){this.rectangle.setStrokeWidth(4);this.rectangle.setOpacity(.5);this.rectangle.setStroke(WorkflowDesignerConstants.SelectColor);this.selected=true};this.Deselect=function(){this.rectangle.setStrokeWidth(1);this.rectangle.setOpacity(1);this.rectangle.setStroke("black");this.selected=false};this.ObjectMove=function(e){var n=this.control.getAbsolutePosition();n.x+=e.x;n.y+=e.y;this.control.setAbsolutePosition(n);this.Sync();if(t.dependentTransitions.length<1)return;for(var r=0;r<t.dependentTransitions.length;r++){t.dependentTransitions[r].Draw()}};this._onMove=function(){if(t.dependentTransitions.length<1)return;for(var e=0;e<t.dependentTransitions.length;e++){var n=t.dependentTransitions[e];n.Draw()}t.manager.redrawTransitions()};this._onClick=function(e){var n=t.selected;if(!e.evt.ctrlKey)t.designer.DeselectAll();if(n)t.Deselect();else t.Select();t.manager.batchDraw()};this._onDblClick=function(){t.designer.DeselectAll();t.Select();t.manager.batchDraw();t.ShowProperties()};this._onDelete=function(){if(confirm(WorkflowDesignerConstants.DeleteConfirm)){t.Delete();t.designer.redrawAll()}};this._onCreateTransitionAndActivity=function(){t.manager.createTransitionAndActivity(t)};this._onCreateTransition=function(){t.manager.createTransition(t)};this.RegisterTransition=function(e){var t=false;for(var n=0;n<this.dependentTransitions.length;n++){if(this.dependentTransitions[n].GetName()==e.GetName()){t=true;break}}if(!t)this.dependentTransitions.push(e)};this.UnregisterTransition=function(e){var t=false;var n=new Array;for(var r=0;r<this.dependentTransitions.length;r++){if(this.dependentTransitions[r].GetName()!=e.GetName()){n.push(this.dependentTransitions[r])}}this.dependentTransitions=n};this.RegisterTransition=function(e){var t=false;for(var n=0;n<this.dependentTransitions.length;n++){if(this.dependentTransitions[n].GetName()==e.GetName()){t=true;break}}if(!t)this.dependentTransitions.push(e)};this.UnregisterTransition=function(e){var t=false;var n=new Array;for(var r=0;r<this.dependentTransitions.length;r++){if(this.dependentTransitions[r].GetName()!=e.GetName()){n.push(this.dependentTransitions[r])}}this.dependentTransitions=n};this.getRectPos=function(){var e=this.rectangle.getAbsolutePosition();var t=e.x;var n=e.y;var r=t+this.rectangle.getWidth()*this.manager.Layer.getScaleX();var i=n+this.rectangle.getHeight()*this.manager.Layer.getScaleY();return{xl:t,yl:n,xr:r,yr:i}};this.getIntersectingActivity=function(e){var t=this.getRectPos();return e.x>=t.xl&&e.x<t.xr&&e.y>=t.yl&&e.y<t.yr};this.getIntersectingActivityRect=function(e){var t=this.getRectPos();if(e.xl>t.xr||e.xr<t.xl||e.yl>t.yr||e.yr<t.yl)return false;return true};this.ShowProperties=function(){var e=WorkflowDesignerConstants.ActivityFormLabel;var n=[{name:e.ImpOrder,code:"impOrder",field:"Order",type:"input",width:"40px"},{name:e.ImpAction,code:"impAction",field:"ActionName",type:"select",datasource:t.designer.data.AdditionalParams.Actions},{name:e.ImpActionParameter,code:"impparam",field:"Parameter",type:"input"}];var r={type:"form",title:e.Title,width:"800px",data:this.item,elements:[{name:e.Name,field:"Name",type:"input"},{name:e.State,field:"State",type:"input"},{name:e.IsInitial,field:"IsInitial",type:"checkbox"},{name:e.IsFinal,field:"IsFinal",type:"checkbox"},{name:e.IsForSetState,field:"IsForSetState",type:"checkbox"},{name:e.IsAutoSchemeUpdate,field:"IsAutoSchemeUpdate",type:"checkbox"},{name:e.Implementation,field:"Implementation",type:"table",elements:n},{name:e.PreExecutionImplementation,field:"PreExecutionImplementation",type:"table",elements:n}]};var i=new WorkflowDesignerForm(r);var s=function(e,n){var r=true;r&=e.CheckRequired([n],["Name"],WorkflowDesignerConstants.FieldIsRequired);t.designer.data.Activities.forEach(function(i){if(i!=t.item&&i.Name==n.Name){r=false;e.ControlAddError(n.control_Name,WorkflowDesignerConstants.FieldMustBeUnique)}});if(!e.CheckRequired(n.Implementation,["Name","Order"],WorkflowDesignerConstants.FieldIsRequired)){r=false}if(!e.CheckRequired(n.PreExecutionImplementation,["Name","Order"],WorkflowDesignerConstants.FieldIsRequired)){r=false}return r};var o=function(e){if(s(i,e)){i.ClearTempField(e);t.item.Name=e.Name;t.item.State=e.State;t.item.IsInitial=e.IsInitial;t.item.IsFinal=e.IsFinal;t.item.IsForSetState=e.IsForSetState;t.item.IsAutoScheme=e.IsAutoScheme;t.item.Implementation=e.Implementation;t.item.PreExecutionImplementation=e.PreExecutionImplementation;WorkflowDesignerCommon.DataCorrection(t.designer.data);t.designer.Draw(t.designer.data);return true}return false};i.showModal(o)};this.Sync=function(){if(t.item.DesignerSettings==undefined)t.item.DesignerSettings={};var e=t.control.getPosition();t.item.DesignerSettings.X=e.x;t.item.DesignerSettings.Y=e.y}}function WorkflowDesignerBackground(){this.type="WorkflowDesignerBackground";this.init=function(e){var t=this;this.designer=e;this.BackgroundLayer=new Kinetic.Layer;this.designer.Stage.add(this.BackgroundLayer);this.BackgroundLayer.setZIndex(0);this.SelectionLayer=new Kinetic.Layer;this.designer.Stage.add(this.SelectionLayer);this.SelectionLayer.setZIndex(1);var n=new Image;n.onload=function(){t.RectBG.setFillPatternImage(n);t.BackgroundLayer.batchDraw()};n.src=this.designer.Settings.imagefolder+"grid.gif";this.RectBG=new Kinetic.Rect({x:0,y:0,width:5e3,height:5e3,draggable:false,dragBoundFunc:function(e){var n=t.designer.Settings.DefaultMoveStep*t.BackgroundLayer.getScaleX();var r=t.designer.Settings.DefaultMoveStep*t.BackgroundLayer.getScaleY();var i={x:Math.round(e.x/r)*r,y:Math.round(e.y/r)*r};t.designer.GraphLayerSetOffset(-i.x/t.BackgroundLayer.getScaleX(),-i.y/t.BackgroundLayer.getScaleY());return i},designerparam:"background"});this.BackgroundLayer.add(this.RectBG);this.BackgroundLayer.batchDraw();this.designer.Stage.on("mousedown.background",function(e){if(!t._movemodeenabled&&e.target.attrs.designerparam=="background"){t._mousedownpos=t.designer.CorrectPossition({x:e.evt.layerX,y:e.evt.layerY},t.SelectionLayer)}});this.designer.Stage.on("mousemove.backgrounde",function(e){if(!t._movemodeenabled&&t._mousedownpos){var n=t.designer.CorrectPossition({x:e.evt.layerX,y:e.evt.layerY},t.SelectionLayer);t.DrawSelectionRect(n)}});this.designer.Stage.on("mouseup.background",function(e){if(!t._movemodeenabled&&t._mousedownpos!=undefined){var n=t.getSelectionRectPos();if(n==undefined){if(!e.evt.ctrlKey)t.designer.DeselectAll()}else if(Math.abs(n.xl-n.xr)>10||Math.abs(n.yl-n.yr)>10){t.designer.DeselectAll();t.designer.ComponentsExecute("SelectByPosition",n)}}t._mousedownpos=undefined;t.DeleteSelectionRect()})};this.setMoveModeEnabled=function(e){this._movemodeenabled=e;this.RectBG.setDraggable(this._movemodeenabled)};this.LayerScale=function(e){this.BackgroundLayer.setScale({x:this.BackgroundLayer.getScale().x+e,y:this.BackgroundLayer.getScale().y+e})};this.LayerScaleNorm=function(e){this.BackgroundLayer.setScale({x:1,y:1});this.SelectionLayer.setScale({x:1,y:1});this.RectBG.setPosition({x:0,y:0})};this.DrawSelectionRect=function(e){if(!this.RectSelection){this.RectSelection=new Kinetic.Rect({x:this._mousedownpos.x,y:this._mousedownpos.y,width:e.x-this._mousedownpos.x,height:e.y-this._mousedownpos.y,draggable:false,fill:"#66CCFF",opacity:.2});this.SelectionLayer.add(this.RectSelection)}else{this.RectSelection.setWidth(e.x-this._mousedownpos.x);this.RectSelection.setHeight(e.y-this._mousedownpos.y)}this.SelectionLayer.batchDraw()};this.DeleteSelectionRect=function(e){if(this.RectSelection){this.RectSelection.destroy();this.RectSelection=undefined;this.SelectionLayer.batchDraw()}};this.getSelectionRectPos=function(){if(this.RectSelection==undefined)return undefined;var e=this.RectSelection.getAbsolutePosition();var t=e.x;var n=e.y;var r=t+this.RectSelection.getWidth()*this.SelectionLayer.getScaleX();var i=n+this.RectSelection.getHeight()*this.SelectionLayer.getScaleX();return{xl:Math.min(t,r),yl:Math.min(n,i),xr:Math.max(t,r),yr:Math.max(n,i)}}}function WorkflowDesignerForm(e){this.type="WorkflowDesignerForm";this.parameters=e;this.id=WorkflowDesignerCommon.createUUID();this.isReadOnly=function(){return this.parameters.readonly};this.showModal=function(e){var t=this;t.window=$("<div></div>");t.window.id=this.id;if(this.parameters.type=="table"){var n=this.generateTable(this.parameters);t.window.append(n)}else if(this.parameters.type=="form"){var r=this.generateForm(this.parameters);if(this.parameters.renderFinalFunc!=undefined){this.parameters.renderFinalFunc(r)}t.window.append(r)}t.window.dialog({modal:true,title:this.parameters.title,width:this.parameters.width,maxHeight:WorkflowDesignerConstants.FormMaxHeight,beforeClose:function(n,r){t.ClearError();if(e!=undefined&&!t.isReadOnly()){var i=t.getEditData(t.parameters);return e(i,t.parameters)}},close:function(e,t){$(this).dialog("destroy").remove()}})};this.getEditData=function(e){var t=this;var n;if(e.type=="form"){n={};e.elements.forEach(function(e){n["control_"+e.field]=e.control;if(e.type=="table"||e.type=="form"){n[e.field]=t.getEditData(e)}else{t.SetValueByPropertyName(n,e.field,t.getEasyControlValue(e))}})}else if(e.type=="table"){n=[];var r=e.control;e.elements.forEach(function(e){var i=t.getElementCode(e);var s="[name="+i+"]";var o=r.find(s);if(o!=undefined){for(var u=0;u<o.length;u++){if(n[u]==undefined)n[u]={};n[u]["control_"+e.field]=o[u];if(e.type=="table"||e.type=="form"){n[u][e.field]=t.getEditData({type:e.type,control:$(o[u]),elements:e.elements})}else{t.SetValueByPropertyName(n[u],e.field,t.getEasyControlValue({type:e.type,control:o[u]}))}}}});if(e.keyproperty){var i=r.children("tbody").children("tr");for(var s=0;s<i.length;s++){if(n[s]==undefined)n[s]={};n[s].keyproperty=$(i[s]).attr("keyproperty")}}}return n};this.generateForm=function(e,t){var n=this;var r=$('<table class="WorkflowDesignerTable"></table>');r.attr("name",n.getElementCode(e));var i=new Array;e.elements.forEach(function(r){var s=$("<tr></tr>");if(t==undefined)t="";var o=t+"_"+r.field;var u=$("<label>oooo</label>");u[0].innerHTML=r.name;s.append($("<td></td>").append(u));if(r.type=="table"){if(r.fieldFunc){r.data=r.fieldFunc(e.data)}else{r.data=e.data[r.field]}var a=n.generateTable(r,o);s.append($("<td></td>").append(a))}else if(r.type=="form"){if(r.fieldFunc){r.data=r.fieldFunc(e.data)}else{r.data=e.data[r.field]}var a=n.generateForm(r,o);s.append($("<td></td>").append(a))}else{var f=n.generateEasyControls(r,n.GetValueByPropertyName(e.data,r.field),o);u[0].for=f[0].id;r.control=f[0];s.append($("<td></td>").append(f[0]))}i.push(s)});e.control=r;r.append(i);return r};this.generateTable=function(e,t){var n=this;var r=$('<table class="WorkflowDesignerTable"></table>');r.attr("name",n.getElementCode(e));var i=$("<thead></thead>");var s=$("<tr></tr>");e.elements.forEach(function(e){var t=$("<th></th>");t[0].innerHTML=e.name;if(e.width!=undefined)t[0].width=e.width;s.append(t)});if(!this.isReadOnly()){s.append("<th></th>")}i.append(s);r.append(i);var o=function(i){var s=$("<tr></tr>");if(e.keyproperty)s.attr("keyproperty",i[e.keyproperty]);if(t==undefined)t="";var o=t+WorkflowDesignerCommon.createUUID();e.elements.forEach(function(e){if(e.type=="table"){if(e.fieldFunc){e.data=e.fieldFunc(i)}else{e.data=i[e.field]}var t=n.generateTable(e,o);s.append($("<td></td>").append(t))}else{var r=n.generateEasyControls(e,n.GetValueByPropertyName(i,e.field),o);s.append($("<td></td>").append(r))}});if(!n.isReadOnly()){var u=$('<a class="btnDelete"></a>');u[0].innerHTML=WorkflowDesignerConstants.ButtonTextDelete;u[0].href="#";u.on("click",function(){s.remove()});s.append($("<td></td>").append(u))}r.append(s)};if(e.data!=undefined){e.data.forEach(function(e){o(e)})}e.control=r;var u=new Array;u.push(r);if(!this.isReadOnly()){var a=$('<a class="btnAdd"></a>');a[0].innerHTML=WorkflowDesignerConstants.ButtonTextCreate;a[0].href="#";a.on("click",function(){var t={};if(e.datadefault)t=e.datadefault;o(t)});u.push(a)}return u};this.generateEasyControls=function(e,t,n){var r=this;if(e.type=="input"){var i=$('<input style="width: 100%;"></input>');i[0].id=this.generateid(e.field,n);i[0].name=r.getElementCode(e);if(t!=undefined)i[0].value=t;if(r.isReadOnly())i.attr("readonly",true);return i}else if(e.type=="checkbox"){var i=$('<input style="width: 100%;"></input>');i[0].type="checkbox";i[0].id=this.generateid(e.field,n);i[0].checked=t;i[0].name=r.getElementCode(e);if(r.isReadOnly())i.attr("disabled","disabled");return i}else if(e.type=="select"){var i=$('<select style="width: 100%;"></select>');i[0].id=this.generateid(e.field,n);i[0].name=r.getElementCode(e);i.append($("<option></option>"));if(e.datasource!=undefined){e.datasource.forEach(function(n){var s=$("<option></option>");if(e.displayfield==undefined){s[0].value=n;s[0].innerHTML=n}else{s[0].value=n[e.displayfield];s[0].innerHTML=n[e.displayfield]}if(s[0].value==t){s[0].selected="selected"}if(r.isReadOnly())i.attr("readonly",true);i.append(s)})}return i}else if(e.type=="textarea"){var i=$('<textarea rows="6" style="width: 100%;"></textarea>');i[0].id=r.generateid(e.field,n);i[0].name=r.getElementCode(e);if(t!=undefined)i[0].value=t;if(this.isReadOnly())i.attr("readonly",true);return i}};this.getEasyControlValue=function(e){var t=this;if(e.type=="input"){return e.control.value}else if(e.type=="checkbox"){return e.control.checked}else if(e.type=="select"){return e.control.value}else if(e.type=="textarea"){return e.control.value}};this.generateid=function(e,t){if(t)return e+"_"+t+"_"+this.id;else return e+"_"+this.id};this.GetValueByPropertyName=function(e,t){if(e==undefined)return undefined;if(t.indexOf(".")<0){return e[t]}else{var n=e;t.split(".").forEach(function(e){if(n!=undefined)n=n[e]});return n}};this.SetValueByPropertyName=function(e,t,n){if(t.indexOf(".")<0){return e[t]=n}else{var r=e;var i=t.split(".");for(var s=0;s<i.length;s++){var o=i[s];if(s==i.length-1)r[o]=n;else{r=r[o]={}}}}};this.ClearError=function(){var e=this.window.find(".field-validation-error");e.attr("title","");e.removeClass("field-validation-error")};this.ControlAddError=function(e,t){var n=$(e);n.addClass("field-validation-error");n.attr("title",t)};this.CheckRequired=function(e,t,n){var r=this;var i=true;e.forEach(function(e){t.forEach(function(t){if(r.GetValueByPropertyName(e,t)==""){r.ControlAddError(e["control_"+t],n);i=false}})});return i};this.CheckUnique=function(e,t,n){var r=this;var i=true;for(var s=0;s<e.length;s++){for(var o=s+1;o<e.length;o++){if(this._checkUniqueEquals(e[s],e[o],t)){t.forEach(function(t){r.ControlAddError(e[s]["control_"+t],n);r.ControlAddError(e[o]["control_"+t],n)});i=false}}}return i};this._checkUniqueEquals=function(e,t,n){for(var r=0;r<n.length;r++){var i=n[r];if(e[i]!=t[i]){return false}}return true};var t=this;this.ClearTempField=function(e,n){if(e==undefined)return;if(n==undefined)n=this.parameters.elements;n.forEach(function(r){if($.isArray(e)){e.forEach(function(e){t.ClearTempField(e,n)})}else{if(e["control_"+r.field]!=undefined)e["control_"+r.field]=undefined}if(r.elements){t.ClearTempField(e[r.field],r.elements)}})};this.getElementCode=function(e){if(e.code!=undefined)return e.code;return e.field}}function WorkflowDesignerKeyboard(){this.type="WorkflowDesignerKeyboard";this.init=function(e){this.designer=e}}function WorkflowDesignerTooltip(e,t,n,r){var i=this;t.on("mouseover",function(){if(t.ToolTip!=undefined){return}var i=new Kinetic.Label({x:t.getX()+t.getWidth()/2,y:t.getY()+30,opacity:.75});i.add(new Kinetic.Tag({fill:"black",pointerDirection:"up",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOffset:10,shadowOpacity:.5}));i.add(new Kinetic.Text({text:n,fontFamily:"Calibri",fontSize:12,padding:5,fill:"white"}));if(r){i.attrs.x=0;i.attrs.y=15;t.add(i)}else{e.add(i)}t.ToolTip=i;e.batchDraw()});t.on("mouseleave",function(){i.Destroy(t);e.batchDraw()});this.Destroy=function(e){if(e.ToolTip!=undefined){e.ToolTip.destroy();e.ToolTip=undefined}}}function WorkflowDesignerTransition(){this.type="WorkflowDesignerTransition";this.init=function(e){this.designer=e;this.Layer=new Kinetic.Layer;this.designer.Stage.add(this.Layer);this.Layer.setZIndex(2);this.designer=e;this.APLayer=new Kinetic.Layer;this.designer.Stage.add(this.APLayer);this.APLayer.setZIndex(3);this.ImageDelete=new Image;this.ImageDelete.src=this.designer.Settings.imagefolder+"designer.delete.png"};this.ItemControls=new Array;this.draw=function(){if(this.ItemControls!=null){this.ItemControls.forEach(function(e){e.destroy()})}this.ItemControls=new Array;var e=this;if(this.designer.data.Transitions!=undefined){this.designer.data.Transitions.forEach(function(t){var n=e.designer.GetComponentByType("WorkflowDesignerActivity");var r=new WorkflowDesignerTransitionControl({from:n.find(t.From),to:n.find(t.To),item:t,designer:e.designer,manager:e});e.ItemControls.push(r);r.Draw()})}this.batchDraw()};this.batchDraw=function(){this.Layer.batchDraw();this.APLayer.batchDraw()};this.getIntersectingActivity=function(e){var t=this.designer.GetComponentByType("WorkflowDesignerActivity");return t.getIntersectingActivity(e)};this.LayerSetOffset=function(e,t){this.Layer.setOffset(e,t);this.APLayer.setOffset(e,t)};this.LayerScale=function(e){this.Layer.setScale({x:this.Layer.getScale().x+e,y:this.Layer.getScale().y+e});this.APLayer.setScale({x:this.APLayer.getScale().x+e,y:this.APLayer.getScale().y+e})};this.LayerScaleNorm=function(e){this.Layer.setScale({x:1,y:1});this.Layer.setOffset({x:0,y:0});this.APLayer.setScale({x:1,y:1});this.APLayer.setOffset({x:0,y:0})};this.DeselectAll=function(){this.ItemControls.forEach(function(e){e.Deselect()})};this.GetSelected=function(){var e=new Array;this.ItemControls.forEach(function(t){if(t.selected)e.push(t)});return e};this.SelectByPosition=function(e){this.ItemControls.forEach(function(t){if(t.getIntersectingRect(e))t.Select()})};this.SelectByItem=function(e){this.ItemControls.forEach(function(t){if(t.item==e)t.Select()})};this.CreateNewTransition=function(e,t){var n=this;if(t==undefined){var r=e.control.getX()+e.rectangle.attrs.width;var i=e.control.getY()+e.rectangle.attrs.height/2;var s={x:r,y:i};var o=new WorkflowDesignerTransitionTempControl({x:s.x,y:s.y,manager:this});o.Draw(s.x+10,s.y);this.batchDraw();var u=function(e){var t=n.designer.CorrectPossition({x:e.evt.layerX,y:e.evt.layerY},n.Layer);o.Redraw(t);n.Layer.batchDraw()};var a=function(t){var r={x:t.evt.layerX,y:t.evt.layerY};var i=n.getIntersectingActivity(r);if(i!=undefined){n.CreateNewTransition(e,i)}o.Delete();n.designer.Stage.off("mousemove.WorkflowDesignerTransitionTempControl",u);n.designer.Stage.off("mouseup.WorkflowDesignerTransitionTempControl",a);n.batchDraw()};this.designer.Stage.on("mousemove.WorkflowDesignerTransitionTempControl",u);this.designer.Stage.on("mouseup.WorkflowDesignerTransitionTempControl",a);return o}else{var f={Name:this.GetDefaultName(e.GetName(),t.GetName()),From:e.item,To:t.item,Trigger:{Type:"Auto"},Condition:{Type:"Always"},Classifier:"Direct",DesignerSettings:{}};var l=new WorkflowDesignerTransitionControl({from:e,to:t,item:f,designer:n.designer,manager:n});n.ItemControls.push(l);this.designer.data.Transitions.push(f);l.Draw();return l}};this.GetDefaultName=function(e,t){var n=e+"_"+t+"_";var r=1;for(var i=0;i<this.designer.data.Transitions.length;i++){var s=this.designer.data.Transitions[i];if(s.Name==n+r){r++;i=-1}}return n+r}}function WorkflowDesignerToolbar(){this.type="WorkflowDesignerToolbar";var e=this;this.init=function(t){this.designer=t;this.Layer=new Kinetic.Layer;this.designer.Stage.add(this.Layer);this.Layer.setZIndex(4);var n=20;var r=10;var i=0;this.Items.forEach(function(t){t.index=i;i++;if(!t.separator){t.ImageToolbar=new Image;t.ImageToolbar.onload=function(){t.cImageToolbar=new Kinetic.Image({x:n+t.index*40,y:r,image:t.ImageToolbar,width:32,height:32,strokeWidth:0});t.cImageToolbar.on("click",t.click);e.Layer.add(t.cImageToolbar);WorkflowDesignerTooltip(e.Layer,t.cImageToolbar,t.title);e.Layer.batchDraw()};t.ImageToolbar.src=e.designer.Settings.imagefolder+t.img;if(t.imgactive){t.ImageActiveToolbar=new Image;t.ImageActiveToolbar.src=e.designer.Settings.imagefolder+t.imgactive}}});this.CreateInfoBlock({x:n+(this.Items[this.Items.length-1].index+1)*40,y:r-7});var s=this.GetWorkflowDesignerBackground();s.RectBG.setDraggable(false)};this.draw=function(){this.GraphRedrawAll()};this.GraphRedrawAll=function(){this.UpdateInfoBlock();this.Layer.batchDraw()};this.CreateInfoBlock=function(e){this.infoText=new Kinetic.Text({text:this.GetInfoBlockText(),fontFamily:"Calibri",fontSize:12,padding:5,fill:"black"});this.info=new Kinetic.Group(e);this.info.add(this.infoText);this.Layer.add(this.info)};this.UpdateInfoBlock=function(e){this.infoText.setText(this.GetInfoBlockText())};this.GetInfoBlockText=function(){var e=0;var t=0;var n=0;if(this.designer.data!=undefined){e=this.designer.data.Activities.length;t=this.designer.data.Transitions.length;n=this.designer.data.Commands.length}return WorkflowDesignerConstants.InfoBlockLabel.Activity+e+"\r\n"+WorkflowDesignerConstants.InfoBlockLabel.Transition+t+"\r\n"+WorkflowDesignerConstants.InfoBlockLabel.Command+n};this.ToolbarMovePress=function(){var e=this.GetWorkflowDesignerBackground();e.setMoveModeEnabled(!e._movemodeenabled);var t=this.GetItemByCode("move").cImageToolbar;if(e._movemodeenabled){t.setStrokeWidth(4);t.setStrokeEnabled(true);t.setStroke(WorkflowDesignerConstants.SelectColor)}else{t.setStrokeEnabled(false);t.setStroke("black")}this.Layer.batchDraw()};this.GetWorkflowDesignerBackground=function(){return this.designer.GetComponentByType("WorkflowDesignerBackground")};this.CreateActivity=function(){var e=this.designer.GetComponentByType("WorkflowDesignerActivity");e.CreateNewActivity();this.designer.redrawAll()};this.AutoArrangement=function(){if(e.designer.data.Activities.length==0)return;var t=new Array;e.designer.data.Activities.forEach(function(e){if(e.IsInitial){t.push(e)}});e.designer.data.Activities.forEach(function(n){if(!n.IsInitial){var r=true;for(var i=0;i<e.designer.data.Transitions.length;i++){var s=e.designer.data.Transitions[i];if(s.Classifier=="Direct"&&s.To==n){r=false;break}}if(r)t.push(n)}});if(t.length==0)t.push(e.designer.data.Activities[0]);var n={x:80,y:80};var r={x:250,y:150};var i=Array();var s=function(t,n,o){var u={x:n.x,y:n.y};if(!o)u.x+=r.x;var a=new Array;for(var f=0;f<t.length;f++){var l=t[f];if(l.DesignerSettings==undefined)l.DesignerSettings={};if(!o&&$.inArray(l,i)>=0){continue}l.DesignerSettings.X=u.x;i.push(l);a.push(l)}for(var f=0;f<a.length;f++){var l=a[f];if(f>0)u.y+=r.y;var c=new Array;e.designer.data.Transitions.forEach(function(e){if(e.Classifier=="Direct"&&e.From==l){c.push(e.To)}});l.DesignerSettings.Y=u.y;var h=s(c,{x:u.x,y:u.y});u.y=h.y}return{x:u.x,y:u.y}};s(t,n,true);e.designer.data.Transitions.forEach(function(e){if(e.DesignerSettings==undefined)e.DesignerSettings={};e.DesignerSettings.Bending=0});e.designer.Draw(e.designer.data)};this.CopySelectedGenUniqueValue=function(e,t,n){var r=e;for(var i=1;true;i++){var s=false;for(var o=0;o<t.length;o++){if(t[o][n]==r){s=true;break}}if(!s){break}r=e+"_"+i}return r};this.CopySelected=function(){var t=this.designer.GetComponentByType("WorkflowDesignerActivity");var n=this.designer.GetComponentByType("WorkflowDesignerTransition");var r=t.GetSelected();var i=n.GetSelected();var s=[];r.forEach(function(t){var n=JSON.parse(JSON.stringify(t.item));n.DesignerSettings.Y+=150;n.Name=e.CopySelectedGenUniqueValue(n.Name,e.designer.data.Activities,"Name");s.push({oldItem:t.item,newItem:n});e.designer.data.Activities.push(n)});var o=[];i.forEach(function(t){var n=t.item.From;var r=t.item.To;for(var i=0;i<s.length;i++){if(n==s[i].oldItem)n=s[i].newItem;if(r==s[i].oldItem)r=s[i].newItem}var u=JSON.parse(JSON.stringify(t.item));u.Name=e.CopySelectedGenUniqueValue(u.Name,e.designer.data.Transitions,"Name");u.From=n;u.To=r;o.push({oldItem:t.item,newItem:u});e.designer.data.Transitions.push(u)});WorkflowDesignerCommon.DataCorrection(e.designer.data);e.designer.Draw(e.designer.data);s.forEach(function(e){t.SelectByItem(e.newItem)});o.forEach(function(e){n.SelectByItem(e.newItem)})};this.EditLocalization=function(){var t=WorkflowDesignerConstants.LocalizationFormLabel;var n={type:"table",title:t.Title,width:"800px",data:this.designer.data.Localization,datadefault:{Culture:"en-US",Type:"State"},elements:[{name:t.ObjectName,field:"ObjectName",type:"input"},{name:t.Type,field:"Type",type:"select",displayfield:"Name",valuefield:"Value",datasource:[{Name:t.Types[0],Value:"Command"},{Name:t.Types[1],Value:"State"},{Name:t.Types[2],Value:"Parameter"}]},{name:t.IsDefault,field:"IsDefault",type:"checkbox"},{name:t.Culture,field:"Culture",type:"input"},{name:t.Value,field:"Value",type:"input"}]};var r=new WorkflowDesignerForm(n);var i=function(t,i){if(r.CheckRequired(t,["ObjectName","Type","Culture","Value"],WorkflowDesignerConstants.FieldIsRequired)&&r.CheckUnique(t,["ObjectName","Type","Culture"],WorkflowDesignerConstants.FieldMustBeUnique)){r.ClearTempField(t);e.SyncTable(e.designer.data.Localization,t,n);return true}return false};r.showModal(i)};this.EditTimer=function(){var t=WorkflowDesignerConstants.TimerFormLabel;var n={type:"table",title:t.Title,width:"800px",data:this.designer.data.Timers,keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.Type,field:"Type",type:"select",datasource:this.designer.data.AdditionalParams.TimerTypes},{name:t.Value,field:"Value",type:"input"},{name:t.NotOverrideIfExists,field:"NotOverrideIfExists",type:"checkbox"}]};var r=new WorkflowDesignerForm(n);var i=function(t,i){if(r.CheckRequired(t,["Name","Type","Value"],WorkflowDesignerConstants.FieldIsRequired)&&r.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)){r.ClearTempField(t);if(e.designer.data.Timers==undefined)e.designer.data.Timers=[];e.SyncTable(e.designer.data.Timers,t,n);return true}return false};r.showModal(i)};this.EditActors=function(){var t=WorkflowDesignerConstants.ActorFormLabel;var n={type:"table",title:t.Title,width:"800px",data:this.designer.data.Actors,keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.Rule,field:"Rule",type:"select",datasource:this.designer.data.AdditionalParams.Rules},{name:t.Value,field:"Value",type:"input"}]};var r=new WorkflowDesignerForm(n);var i=function(t,i){if(r.CheckRequired(t,["Name","Rule"],WorkflowDesignerConstants.FieldIsRequired)&&r.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)){r.ClearTempField(t);e.SyncTable(e.designer.data.Actors,t,n);return true}return false};r.showModal(i)};this.EditParameters=function(){var t=WorkflowDesignerConstants.ParameterFormLabel;var n={type:"table",title:t.Title,width:"800px",data:this.designer.data.Parameters,datadefault:{Purpose:"Persistence"},keyproperty:t.Name,elements:[{name:t.Name,field:"Name",type:"input"},{name:t.Type,field:"Type",type:"input"},{name:t.Purpose,field:"Purpose",type:"select",displayfield:"Name",datasource:[{Name:"Temporary"},{Name:"Persistence"},{Name:"System"}]},{name:t.DefaultValue,field:"DefaultValue",type:"input"}]};var r=new WorkflowDesignerForm(n);var i=function(t,i){if(r.CheckRequired(t,["Name","Type","Purpose","Parameter"],WorkflowDesignerConstants.FieldIsRequired)&&r.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique)){r.ClearTempField(t);e.SyncTable(e.designer.data.Parameters,t,n);return true}return false};r.showModal(i)};this.EditCommands=function(){var t=WorkflowDesignerConstants.CommandFormLabel;var n={type:"table",title:t.Title,width:"800px",data:this.designer.data.Commands,datadefault:{},keyproperty:"Name",elements:[{name:t.Name,field:"Name",type:"input"},{name:t.InputParameters,field:"InputParameters",type:"table",elements:[{name:t.InputParametersName,code:"ipname",field:"Name",type:"input"},{name:t.InputParametersParameter,code:"ipparameter",field:"Parameter.Name",type:"select",displayfield:"Name",datasource:e.designer.data.Parameters}]}]};var r=new WorkflowDesignerForm(n);var i=function(e,t){var n=true;n&=e.CheckRequired(t,["Name"],WorkflowDesignerConstants.FieldIsRequired);n&=e.CheckUnique(t,["Name"],WorkflowDesignerConstants.FieldMustBeUnique);t.forEach(function(t){if(!e.CheckRequired(t.InputParameters,["Name","Parameter.Name"],WorkflowDesignerConstants.FieldIsRequired)){n=false}});return n};var s=function(t){if(i(r,t)){r.ClearTempField(t);e.SyncTable(e.designer.data.Commands,t,n);WorkflowDesignerCommon.DataCorrection(e.designer.data);e.GraphRedrawAll();return true}return false};r.showModal(s)};this.EditAdditionalParameters=function(){var e=WorkflowDesignerConstants.AdditionalParamsFormLabel;var t={type:"form",title:e.Title,width:"800px",data:this.designer.data.AdditionalParams,readonly:true,elements:[{name:e.IsObsolete,field:"IsObsolete",type:"checkbox"},{name:e.DefiningParameters,field:"DefiningParameters",type:"textarea"},{name:e.ProcessParameters,field:"ProcessParameters",type:"table",elements:[{name:e.ProcessParametersName,field:"Name",type:"input"},{name:e.ProcessParametersValue,field:"Value",type:"input"}]}]};var n=new WorkflowDesignerForm(t);var r=function(e,t){return true};n.showModal(r)};this.Items=[{title:WorkflowDesignerConstants.ToolbarLabel.CreateActivity,img:"designer.tb.add.png",click:function(){e.CreateActivity()}},{title:WorkflowDesignerConstants.ToolbarLabel.CopySelected,img:"designer.tb.copy.png",click:function(){e.CopySelected()}},{title:WorkflowDesignerConstants.ButtonTextDelete,img:"designer.tb.delete.png",click:function(){e.designer.DeleteSelected()}},{separator:true},{title:WorkflowDesignerConstants.ToolbarLabel.Move,img:"designer.tb.move.png",code:"move",click:function(){e.ToolbarMovePress()}},{title:WorkflowDesignerConstants.ToolbarLabel.ZoomIn,img:"designer.tb.zoomIn.png",click:function(){e.designer.GraphLayerScale(.1)}},{title:WorkflowDesignerConstants.ToolbarLabel.ZoomOut,img:"designer.tb.zoomOut.png",click:function(){e.designer.GraphLayerScale(-.1)}},{title:WorkflowDesignerConstants.ToolbarLabel.ZoomPositionDefault,img:"designer.tb.zoomnorm.png",click:function(){e.designer.GraphLayerScaleNorm()}},{title:WorkflowDesignerConstants.ToolbarLabel.AutoArrangement,img:"designer.tb.arrangment.png",click:function(){e.AutoArrangement()}},{separator:true},{title:WorkflowDesignerConstants.ToolbarLabel.Actors,img:"designer.tb.actor.png",click:function(){e.EditActors()}},{title:WorkflowDesignerConstants.ToolbarLabel.Commands,img:"designer.tb.command.png",click:function(){e.EditCommands()}},{title:WorkflowDesignerConstants.ToolbarLabel.Parameters,img:"designer.tb.parameter.png",click:function(){e.EditParameters()}},{title:WorkflowDesignerConstants.ToolbarLabel.Localization,img:"designer.tb.locale.png",click:function(){e.EditLocalization()}},{title:WorkflowDesignerConstants.ToolbarLabel.Timers,img:"designer.tb.timer.png",click:function(){e.EditTimer()}},{title:WorkflowDesignerConstants.ToolbarLabel.AdditionalParameters,img:"designer.tb.additionalparameters.png",click:function(){e.EditAdditionalParameters()}}];this.GetItemByCode=function(e){for(var t=0;t<this.Items.length;t++){var n=this.Items[t];if(n.code==e)return n}return undefined};this.SyncTable=function(e,t,n){if(n.keyproperty==undefined){e.splice(0,e.length);for(var r=0;r<t.length;r++){var i={};n.elements.forEach(function(e){i[e.field]=t[r][e.field]});e.push(i)}}else{for(var r=e.length-1;r>=0;r--){var s=$.grep(t,function(t){return e[r][n.keyproperty]==t.keyproperty});if(s.length==0)e.splice(r,1);else{n.elements.forEach(function(t){e[r][t.field]=s[0][t.field]})}}for(var r=0;r<t.length;r++){var s=$.grep(e,function(e){return t[r][n.keyproperty]==e[n.keyproperty]});if(s.length==0){var i={};n.elements.forEach(function(e){i[e.field]=t[r][e.field]});e.push(i)}}}}}function WorkflowDesignerTransitionControl(e){var t=this;this.manager=e.manager;this.designer=e.designer;this.from=e.from;this.to=e.to;this.item=e.item;this.setFrom=function(e){this.from=e;this.item.From=e.item};this.setTo=function(e){this.to=e;this.item.To=e.item};this.GetName=function(){return this.item.Name};this.SetName=function(e){this.item.Name=e};this.control=undefined;this.arrow=undefined;this.line=undefined;if(this.item.DesignerSettings==undefined||this.item.DesignerSettings.Bending==undefined){this.bending=0}else{this.bending=this.item.DesignerSettings.Bending}this.from.RegisterTransition(this);this.to.RegisterTransition(this);this.start=undefined;this.end=undefined;this.middle=undefined;this.angle=undefined;this.lineAngle=undefined;this.activePoint=undefined;this.touchpoints=[];this._getCBPoint=function(e,t,n,r,i,s,o){var u=i;var a=s;var f;if(u<Math.PI/2&&u>0){f=1}else if(u>=Math.PI/2){f=-1}else if(u<=0&&u>-Math.PI/2){f=-1}else{f=1}f=(u>0?1:-1)*f;var l=o*a*f;var c=(e+n)/2;var h=(t+r)/2;var p=c-l*Math.cos(Math.PI/2+u);var d=h-l*Math.sin(Math.PI/2+u);return{x:p,y:d}};this.DrawTransition=function(e,t){var n=this.bending;var r=this;var i=50;var s=this.from.rectangle;var o=this.to.rectangle;var u,a,f,l;u=this.from.getX();a=this.from.getY();f=this.to.getX();l=this.to.getY();var c=u+s.attrs.width/2;var h=a+s.attrs.height/2;var p=f+o.attrs.width/2;var d=l+o.attrs.height/2;var v,m,g,y;if(p>=c-i-o.attrs.width/2&&p<=c+i+o.attrs.width/2&&d>=h){v=c;m=a+s.attrs.height;g=p;y=l}else if(p>=c-i-o.attrs.width/2&&p<=c+i+o.attrs.width/2&&d<h){v=c;m=a;g=p;y=l+o.attrs.height}else if(p<c){v=u;m=h;g=f+o.attrs.width;y=d}else{v=u+s.attrs.width;m=a+s.attrs.height/2;g=f;y=l+o.attrs.height/2}if(e!=undefined){v=e.x;m=e.y}if(t!=undefined){g=t.x;y=t.y}var b=Math.atan2(y-m,g-v);var w=this._getLineLength(v,m,g,y);var E=this._getCBPoint(v,m,g,y,b,w,n);var S=E.x;var x=E.y;var T=.5;var N=Math.atan2(y-x,g-S);var C=Math.PI/10*(n>0?1:n<0?-1:0);if(Math.abs(b)>=Math.PI/2)C=-C;N+=C;var k=this.item.Classifier==undefined?"notspecified":this.item.Classifier.toLowerCase();var L=k=="notspecified"?"gray":k=="direct"?"green":"red";this.start={x:v,y:m};this.end={x:g,y:y};this.middle={x:S,y:x};this.angle=N;this.lineAngle=b;if(this.control){WorkflowDesignerCommon.updateArrowByAngle(this.arrow,g,y,N,15,L);this.line.setPoints([v,m,S,x,g,y]);this.line.setTension(T)}else{this.control=new Kinetic.Group({x:0,y:0,rotationDeg:0});this.arrow=WorkflowDesignerCommon.createArrowByAngle(g,y,N,15,L);this.line=new Kinetic.Line({points:[v,m,S,x,g,y],stroke:L,strokeWidth:1,lineCap:"round",lineJoin:"round",tension:T});this.control.add(this.line);this.control.add(this.arrow);this.manager.Layer.add(this.control)}};this.DrawActivePoint=function(){if(this.activePoint){this._moveActivePoint(this.middle.x,this.middle.y)}else{var e=this._createActivePoint(this.middle.x,this.middle.y,this.control);t.manager.APLayer.add(e);this.activePoint=e}};this.DrawTouchPoints=function(){var e=this._getLineLength(this.start.x,this.start.y,this.end.x,this.end.y)*.1;if(this.touchpoints.length==2){this._moveTouchPoints(this.touchpoints[0],this.start.x,this.start.y,e,this.angle,this.lineAngle);this._moveTouchPoints(this.touchpoints[1],this.end.x,this.end.y,e,this.angle,this.lineAngle,true)}else{var n=this._createTouchPoint(this.start.x,this.start.y,e,this.angle,this.lineAngle,this.control);var r=this._createTouchPoint(this.end.x,this.end.y,e,this.angle,this.lineAngle,this.control,true);t.manager.APLayer.add(n);t.manager.APLayer.add(r);this.touchpoints=[n,r]}};this.Draw=function(e,t){this.DrawTransition(e,t);this.DrawActivePoint();this.DrawTouchPoints()};this.DeleteTouchPoint=function(e){for(var t=0;t<this.touchpoints.length;t++){if(this.touchpoints[t].isend==e){this.touchpoints[t].destroy()}}};this.Delete=function(){this.from.UnregisterTransition(this);this.to.UnregisterTransition(this);this.control.destroy();if(this.activePoint.ToolTip!=undefined){this.activePoint.ToolTip.destroy()}this.activePoint.destroy();for(var e=0;e<this.touchpoints.length;e++){this.touchpoints[e].destroy()}this.designer.data.Transitions.splice(this.designer.data.Transitions.indexOf(this.item),1);this.manager.ItemControls.splice(this.manager.ItemControls.indexOf(this),1)};this._onDelete=function(){if(confirm(WorkflowDesignerConstants.DeleteConfirm)){t.Delete();t.designer.redrawAll()}};this.Select=function(){this.oldstroke=this.line.getStroke();this.line.setStroke(WorkflowDesignerConstants.SelectColor);this.line.setStrokeWidth(3);this.selected=true};this.Deselect=function(){this.line.setStrokeWidth(1);if(this.oldstroke!=undefined){this.line.setStroke(this.oldstroke)}this.selected=false};this._moveTouchPoints=function(e,t,n,r,i,s,o){var u=s*180/Math.PI;e.setPosition({x:t,y:n});e.setRotationDeg(u);e.circle.setPosition({x:(o?-1:1)*r*Math.cos(-(i-s)),y:r*Math.sin(-(i-s))})};this._createTouchPoint=function(e,t,n,r,i,s,o){var u=this;var a=i*180/Math.PI;var f=new Kinetic.Group({x:e,y:t,rotationDeg:a,draggable:true});f.isend=o;var l=new Kinetic.Circle({x:(o?-1:1)*n*Math.cos(-(r-i)),y:n*Math.sin(-(r-i)),radius:5,fill:"lightgray"});f.add(l);f.circle=l;f.transition=s;var c=function(){var e=u.designer.CorrectPossition(l.getAbsolutePosition(),u.manager.Layer);if(u.oldbending==undefined)u.oldbending=u.bending;u.bending=0;var t=e;if(o){u.DrawTransition(undefined,t)}else{u.DrawTransition(t,undefined)}u.DrawActivePoint();u.DeleteTouchPoint(!o);u.manager.batchDraw()};f.on("dragmove",function(){c()});f.on("dragend",function(){var e=l.getAbsolutePosition();var t=u.manager.getIntersectingActivity(e);if(t!=undefined){u.oldbending=undefined;u.bending=0;u.Sync();if(o){u.to.UnregisterTransition(u);u.setTo(t);u.to.RegisterTransition(u)}else{u.from.UnregisterTransition(u);u.setFrom(t);u.from.RegisterTransition(u)}u.Draw()}else{u.bending=u.oldbending;u.oldbending=undefined;u.Draw()}});return f};this._moveActivePoint=function(e,t){this.activePoint.setPosition({x:e,y:t})};this._createActivePoint=function(e,t,n){var r=this;var i=new Kinetic.Group({x:e,y:t,rotationDeg:0,draggable:true});var s=new Kinetic.Circle({x:0,y:0,radius:15,fill:"lightgray"});i.add(s);var o="";var u=this.item.Trigger.Type.toLowerCase();if(u=="auto"){o+="A"}else if(u=="command"){o+="C"}else if(u=="timer"){o+="T"}var a=this.item.Condition.Type.toLowerCase();if(a=="always"){o+="A"}else if(a=="action"){o+="C"}else if(a=="otherwise"){o+="O"}var f=new Kinetic.Text({x:-12,y:-11,text:o,fontSize:20,fontFamily:"Calibri",fill:"black",fontStyle:"bold"});i.add(f);var l=new Kinetic.Image({x:12,y:-20,image:this.manager.ImageDelete,width:10,height:10});l.on("click",this._onDelete);i.add(l);i.transition=n;var c=function(e,t){var n=i.getPosition();if(t)r.bending=0;else{r.bending=r._getBendingKoeff(r.start.x,r.start.y,r.end.x,r.end.y,n.x,n.y)}if(Math.abs(r.bending)<.07)r.bending=0;r.DrawTransition();r.DrawTouchPoints();if(e){r.DrawActivePoint();r.Sync()}r.manager.batchDraw()};i.on("click",function(e){var t=r.selected;if(!e.evt.ctrlKey)r.designer.DeselectAll();if(t)r.Deselect();else r.Select();r.manager.batchDraw()});i.on("dblclick",function(){r.designer.DeselectAll();r.Select();r.manager.batchDraw();r.ShowProperties()});i.on("dragmove",function(){c(false)});i.on("dragend",function(){c(true)});var h="Trigger: "+this.item.Trigger.Type;if(r.item.Trigger!=undefined&&r.item.Trigger.Command!=undefined&&r.item.Trigger.Type=="Command")h+=" "+r.item.Trigger.Command.Name;if(r.item.Trigger!=undefined&&r.item.Trigger.Timer!=undefined&&r.item.Trigger.Type=="Timer")h+=" "+r.item.Trigger.Timer.Name;h+="\r\nCondition: "+this.item.Condition.Type;if(r.item.Condition!=undefined&&r.item.Condition.Type=="Action")h+=" "+r.item.Condition.ActionName;WorkflowDesignerTooltip(r.manager.Layer,i,h,true);return i};this._getLineLength=function(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))};this._getBendingKoeff=function(e,t,n,r,i,s){var o=t-r;var u=n-e;var a=e*r-n*t;if(u<=0){o=-o;u=-u;a=-a}var f=-(a+o*i)/u;var l=f<s?-1:1;var c=this._getLineLength(e,t,n,r);var h=(e+n)/2;var p=(t+r)/2;var d=this._getLineLength(h,p,i,s);var v=d/c*l;if(u==0)v=-v;return v};this.getIntersectingRect=function(e){var t=this.activePoint.getAbsolutePosition();if(t.x>=e.xl&&t.x<e.xr&&t.y>=e.yl&&t.y<e.yr)return true;return false};this.ShowProperties=function(){var e=WorkflowDesignerConstants.TransitionFormLabel;var n={type:"form",title:e.Title,width:"600px",data:this.item,elements:[{name:e.Name,field:"Name",type:"input"},{name:e.From,field:"From.Name",type:"select",displayfield:"Name",datasource:t.designer.data.Activities},{name:e.To,field:"To.Name",type:"select",displayfield:"Name",datasource:t.designer.data.Activities},{name:e.Classifier,field:"Classifier",type:"select",datasource:["Direct","Reverse","NotSpecified"]},{name:e.Restrictions,field:"Restrictions",code:"restrictions",type:"table",datadefault:{Type:"Allow"},elements:[{name:e.RestrictionsType,code:"resttype",field:"Type",type:"select",datasource:["Allow","Restrict"]},{name:e.RestrictionsActor,code:"restactor",field:"Actor.Name",type:"select",displayfield:"Name",datasource:t.designer.data.Actors}]},{name:e.Trigger,field:"Trigger",code:"trigger",type:"form",datadefault:{Type:"Command"},elements:[{name:e.TriggerType,code:"triggertype",field:"Type",type:"select",datasource:["Auto","Command","Timer"]},{name:e.TriggerCommand,code:"triggercommand",field:"Command.Name",type:"select",displayfield:"Name",datasource:t.designer.data.Commands},{name:e.TriggerTimer,code:"triggertimer",field:"Timer.Name",type:"select",displayfield:"Name",datasource:t.designer.data.Timers}]},{name:e.Condition,field:"Condition",code:"condition",type:"form",datadefault:{Type:"Always",ResultOnPreExecution:"Null"},elements:[{name:e.ConditionType,code:"conditiontype",field:"Type",type:"select",datasource:["Always","Action","Otherwise"]},{name:e.ConditionAction,code:"conditionaction",field:"Action.ActionName",type:"select",datasource:t.designer.data.AdditionalParams.Actions},{name:e.ResultOnPreExecution,code:"conditionresult",field:"ResultOnPreExecution",type:"select",datasource:["True","False"]}]}],renderFinalFunc:function(e){var t=e.find("[name=conditiontype]");var n=e.find("[name=conditionaction]").parent().parent();var r=e.find("[name=conditionresult]").parent().parent();var i=function(){var e=t[0].value;if(e=="Action"){n.show();r.show()}else{n.hide();r.hide()}};t.on("change",i);i();var s=e.find("[name=restrictions]").parent().parent();var o=e.find("[name=triggertype]");var u=e.find("[name=triggercommand]").parent().parent();var a=e.find("[name=triggertimer]").parent().parent();var f=function(){var e=o[0].value;if(e=="Command"){u.show();a.hide();s.show()}else if(e=="Timer"){u.hide();a.show();s.hide()}else{u.hide();a.hide();s.hide()}};o.on("change",f);f()}};var r=new WorkflowDesignerForm(n);var i=function(e,n){var r=true;r&=e.CheckRequired([n],["Name"],WorkflowDesignerConstants.FieldIsRequired);var i=["Type"];if(n.Trigger.Type=="Command"){i.push("Command.Name")}else if(n.Trigger.Type=="Timer"){i.push("Timer.Name")}r&=e.CheckRequired([n.Trigger],i,WorkflowDesignerConstants.FieldIsRequired);i=["Type"];if(n.Condition.Type=="Action"){i.push("ActionName")}r&=e.CheckRequired([n.Condition],i,WorkflowDesignerConstants.FieldIsRequired);t.designer.data.Transitions.forEach(function(i){if(i!=t.item&&i.Name==n.Name){r=false;e.ControlAddError(n.control_Name,WorkflowDesignerConstants.FieldMustBeUnique)}});if(!e.CheckRequired(n.Restrictions,["Type","Actor.Name"],WorkflowDesignerConstants.FieldIsRequired)){r=false}return r};var s=function(e){if(i(r,e)){r.ClearTempField(e);t.item.Name=e.Name;t.item.From.Name=e.From.Name;t.item.To.Name=e.To.Name;t.item.Classifier=e.Classifier;t.item.Restrictions=e.Restrictions;t.item.Trigger=e.Trigger;t.item.Condition=e.Condition;WorkflowDesignerCommon.DataCorrection(t.designer.data);t.designer.Draw(t.designer.data);return true}return false};r.showModal(s)};this.Sync=function(){t.item.DesignerSettings.Bending=t.bending};this.destroy=function(){this.control.destroy();this.activePoint.destroy();this.touchpoints.forEach(function(e){e.destroy()})}}function WorkflowDesignerTransitionTempControl(e){this.x=e.x;this.y=e.y;this.manager=e.manager;this.control=undefined;this.Draw=function(e,t){this.control=new Kinetic.Group({x:0,y:0,rotationDeg:0});this.line=new Kinetic.Line({points:[this.x,this.y,e,t],stroke:"#FFCC99",strrokeWidth:1});var n=Math.atan2(t-this.y,e-this.x);this.arrow=WorkflowDesignerCommon.createArrowByAngle(e,t,n,20,"#FFCC99");this.control.add(this.line);this.control.add(this.arrow);this.manager.Layer.add(this.control)};this.Redraw=function(e){this.line.setPoints([this.x,this.y,e.x,e.y]);var t=Math.atan2(e.y-this.y,e.x-this.x);WorkflowDesignerCommon.updateArrowByAngle(this.arrow,e.x,e.y,t,20,"#FFCC99")};this.Delete=function(){this.control.destroy()}}function WorkflowGraph(e,t,n){var r=this;r.container=e;if(t==undefined){t=new Object}if(t.Container==undefined){t.Container="container"}if(t.graphwidth==undefined){t.graphwidth=1024}if(t.graphheight==undefined){t.graphheight=768}if(t.DefaultActivityWidth==undefined){t.DefaultActivityWidth=150}if(t.DefaultActivityHeight==undefined){t.DefaultActivityHeight=75}if(t.DefaultMoveStep==undefined){t.DefaultMoveStep=10}if(t.imagefolder==undefined)t.imagefolder="/images/";this.Settings=t;this.Settings.ContainerStage=this.container+"_stage";$("#"+this.container).append("<div id='"+this.Settings.ContainerStage+"'></div>");this.Stage=new Kinetic.Stage({container:this.Settings.ContainerStage,width:this.Settings.graphwidth,height:this.Settings.graphheight,stroke:"black"});this.Components=new Array;this.AddComponent=function(e){var t=new e;t.init(this);r.Components.push(t);return t};this.GetComponentByType=function(e){for(var t=0;t<this.Components.length;t++){if(this.Components[t].type==e)return this.Components[t]}return undefined};this.ComponentsExecute=function(e,t){r.Components.forEach(function(n){if(n[e])n[e](t)})};if(n){n.forEach(function(e){r.AddComponent(e)})}this.Draw=function(e){r.data=e;r.ComponentsExecute("draw")};this.GraphLayerSetOffset=function(e,t){r.ComponentsExecute("LayerSetOffset",{x:e,y:t});r.redrawAll()};this.GraphLayerScale=function(e){r.ComponentsExecute("LayerScale",e);r.redrawAll()};this.GraphLayerScaleNorm=function(e){r.ComponentsExecute("LayerScaleNorm",e);r.redrawAll()};this.DeselectAll=function(){r.ComponentsExecute("DeselectAll");r.redrawAll()};this.redrawAll=function(){r.ComponentsExecute("GraphRedrawAll");r.Stage.batchDraw()};this.CorrectPossition=function(e,t){if(t.getScaleX()==0||t.getScaleY()==0)return{x:t.getOffsetX(),y:0};return{x:e.x/t.getScaleX()+t.getOffsetX(),y:e.y/t.getScaleY()+t.getOffsetY()}};this.DeleteSelected=function(){var e=new Array;this.Components.forEach(function(t){if(t.GetSelected)e=e.concat(t.GetSelected())});if(e.length>0){if(confirm(WorkflowDesignerConstants.DeleteConfirm)){e.forEach(function(e){e.Delete()});this.redrawAll()}}};this.destroy=function(){this.Stage.destroy()};this.GetCurrentActivity=function(){if(r.data==undefined||r.data.AdditionalParams==undefined||r.data.AdditionalParams.ProcessParameters==undefined){return undefined}for(var e=0;e<r.data.AdditionalParams.ProcessParameters.length;e++){var t=r.data.AdditionalParams.ProcessParameters[e];if(t.Name=="CurrentActivity")return t.Value}return undefined}}var WorkflowDesignerCommon={createArrowByAngle:function(e,t,n,r,i){if(i==undefined)i="red";var s=new Kinetic.Wedge({x:e,y:t,radius:r,angle:40,fill:i,rotation:n*180/Math.PI-200});return s},updateArrowByAngle:function(e,t,n,r,i,s){if(s==undefined)s="red";e.setPosition({x:t,y:n});e.setRadius(i);e.setFill(s);e.setRotation(r*180/Math.PI-200)},createUUID:function(){var e=[];var t="0123456789abcdef";for(var n=0;n<36;n++){e[n]=t.substr(Math.floor(Math.random()*16),1)}e[14]="4";e[19]=t.substr(e[19]&3|8,1);e[8]=e[13]=e[18]=e[23]="-";var r=e.join("");return r},DataCorrection:function(e){if(e.AdditionalParams==undefined)e.AdditionalParams={};if(e.AdditionalParams.Actions==undefined)e.AdditionalParams.Actions=[];if(e.AdditionalParams.Rules==undefined)e.AdditionalParams.Rules=[];var t=function(e,t){if(e==undefined)return;var n=$.grep(t,function(t){return t==e});if(n.length==0)t.push(e)};var n=function(e,t,n){if(e==undefined||t==undefined)return;var r=$.grep(t,function(t){return e==t[n]});if(r.length>0){return r[0]}};e.Activities.forEach(function(n){if(n.Implementation!=undefined){n.Implementation.forEach(function(n){t(n.Name,e.AdditionalParams.Actions)});n.PreExecutionImplementation.forEach(function(n){t(n.Name,e.AdditionalParams.Actions)})}});e.Transitions.forEach(function(r){if(r.From!=undefined){r.From=n(r.From.Name,e.Activities,"Name")}if(r.To!=undefined){r.To=n(r.To.Name,e.Activities,"Name")}if(r.Restrictions!=undefined){r.Restrictions.forEach(function(t){t.Actor=n(t.Actor.Name,e.Actors,"Name")})}if(r.Condition!=undefined&&r.Condition.Action!=undefined){t(r.Condition.Action.Name,e.AdditionalParams.Actions)}if(r.Trigger!=undefined&&r.Trigger.Command!=undefined){r.Trigger.Command=n(r.Trigger.Command.Name,e.Commands,"Name")}if(r.Trigger!=undefined&&r.Trigger.Timer!=undefined){r.Trigger.Timer=n(r.Trigger.Timer.Name,e.Timers,"Name")}});e.Commands.forEach(function(t){if(t.InputParameters!=undefined){t.InputParameters.forEach(function(t){t.Parameter=n(t.Parameter.Name,e.Parameters,"Name")})}});e.Actors.forEach(function(n){if(n.Rule!=undefined){t(n.Rule,e.AdditionalParams.Rules)}})},download:function(e,t,n){if(e&&t){var r=new Array;t.forEach(function(e){var t=$('<input type="hidden"/>');t.attr("name",e.name);t.attr("value",e.value);r.push(t)});var i=$('<form action="'+e+'" method="'+(n||"post")+'"></form>');i.append(r);i.appendTo("body").submit().remove()}}};var WorkflowDesignerConstants={SelectColor:"yellow",ActivityColor:"#F2F2F2",ActivityInitialColor:"#CCCC99",ActivityFinalColor:"#CC9966",ActivityCurrentColor:"#00CCCC",DeleteConfirm:"Are you sure you want to delete selected item(s)?",FieldIsRequired:"Field is required!",FieldMustBeUnique:"Field must be unique!",ButtonTextDelete:"Delete",ButtonTextCreate:"Create",InfoBlockLabel:{Activity:"Activity: ",Transition:"Transition: ",Command:"Command: "},ActivityNamePrefix:"Activity_",ActivityFormLabel:{Title:"Activity",Name:"Name",State:"State",IsInitial:"Initial",IsFinal:"Final",IsForSetState:"For set state",IsAutoSchemeUpdate:"Auto scheme update",Implementation:"Implementation",PreExecutionImplementation:"PreExecution Implementation",ImpOrder:"Order",ImpAction:"Action",ImpActionParameter:"Action parameter"},TransitionFormLabel:{Title:"Transition",Name:"Name",From:"From activity",To:"To activity",Classifier:"Classifier",Restrictions:"Restrictions",RestrictionsType:"Type",RestrictionsActor:"Actor",Condition:"Condition",ConditionType:"Type",ConditionAction:"Action",ResultOnPreExecution:"Result on PreExecution",Trigger:"Trigger",TriggerType:"Type",TriggerCommand:"Command",TriggerTimer:"Timer"},LocalizationFormLabel:{Title:"Localization",ObjectName:"ObjectName",Type:"Type",IsDefault:"IsDefault",Culture:"Culture",Value:"Value",Types:["Command","State","Parameter"]},TimerFormLabel:{Title:"Timers",Name:"Name",Type:"Type",Value:"Value",Types:["Command","State","Parameter"],NotOverrideIfExists:"Do not override timer if exists"},ParameterFormLabel:{Title:"Parameters",Name:"Name",Type:"Type",Purpose:"Purpose",Value:"Value",DefaultValue:"DefaultValue"},ActorFormLabel:{Title:"Actors",Name:"Name",Rule:"Rule",Value:"Value"},CommandFormLabel:{Title:"Command",Name:"Name",InputParameters:"Input Parameters",InputParametersName:"Name",InputParametersParameter:"Parameter"},AdditionalParamsFormLabel:{Title:"Additional Parameters",IsObsolete:"IsObsolete",DefiningParameters:"Defining parameters",ProcessParameters:"Process parameters",ProcessParametersName:"Name",ProcessParametersValue:"Value"},ToolbarLabel:{CreateActivity:"Create activity",CopySelected:"Copy selected",Undo:"Undo",Redo:"Redo",Move:"Move",ZoomIn:"Zoom In",ZoomOut:"Zoom Out",ZoomPositionDefault:"Zoom and position default set",AutoArrangement:"Auto arrangement",Actors:"Actors",Commands:"Commands",Parameters:"Parameters",Localization:"Localization",Timers:"Timers",AdditionalParameters:"Additional Parameters"},ErrorActivityIsInitialCountText:"One element must be marked flag Initial",ErrorReadOnlySaveText:"The Designer in ReadOnly mode, you can't save it.",FormMaxHeight:500};